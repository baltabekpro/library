<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–Ω–ª–∞–π–Ω –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞ - –ó–∞–º–∞–Ω–∞—É–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
     body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f9f4e8;
    color: #3c3c3c;
    line-height: 1.6;
}

.navbar {
    background-color: #8c6d46;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 15px 0;
    transition: all 0.3s ease;
}

.navbar-brand, .nav-link {
    color: #fff !important;
    font-weight: 500;
    transition: all 0.3s ease;
}

.nav-link:hover {
    color: #f9e4b7 !important;
    transform: translateY(-2px);
}

.hero {
    text-align: center;
    padding: 50px;
    background-image: url('https://www.northampton.ac.uk/wp-content/uploads/2018/02/alfons-morales-410757-unsplash.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: #fff;
    position: relative;
}

.hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1;
}

.hero h1, .hero p {
    position: relative;
    z-index: 2;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

.book-list {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
}

.book-item {
    background-color: #fff;
    padding: 15px;
    width: 200px;
    text-align: center;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    overflow: hidden;
}

.book-item img {
    transition: transform 0.5s ease;
    max-height: 180px;
    object-fit: cover;
}

.book-item:hover img {
    transform: scale(1.05);
}

.book-item:hover {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(-5px);
}

.book-item h3, .book-item h5 {
    font-weight: 600;
    margin-top: 10px;
    font-size: 16px;
    height: 40px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.book-item p {
    font-size: 14px;
    color: #d4a373;
    font-style: italic;
}

.form-control:focus {
    border-color: #d4a373;
    box-shadow: 0 0 5px rgba(212, 163, 115, 0.8);
}

.btn-custom {
    background-color: #fff;
    color: #fff;
    transition: background-color 0.3s;
}

.btn-custom:hover {
    background-color: #fff;
    color: #fff;
}

footer {
    background-color: #d4a373;
    color: #fff;
    padding: 10px 0;
    text-align: center;
}

.form-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 60vh;
}

#main-section {
    display: none;
}

.search-container {
    margin: 20px auto;
    max-width: 600px;
    text-align: center;
}

.search-container input {
    width: 80%;
    padding: 10px;
    border: 1px solid #fff;
    border-radius: 5px;
}

.search-container button {
    padding: 10px 15px;
    background-color: #d4a373;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.search-container button:hover {
    background-color: #d4a373;
    color: #d4a373;
}

.book-list {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
}

.book-item {
    background-color: #fff;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    width: 200px;
    text-align: center;
}

.search-section {
    background-color: #f5e6cc;
}

.search-bar-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
}

#search-bar {
    padding: 10px;
    font-size: 16px;
    border-radius: 5px;
    border: 1px solid #b08968;
}

.search-button {
    padding: 10px 20px;
    background-color: #d4a373;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.search-button:hover {
    background-color: #5a3e2b;
}

.catalog h2, .search-section h2, .contact-section h2, .register-section h2 {
    font-size: 28px;
    margin-bottom: 15px;
    color: #5a3e2b;
}

.genre-button {
    background-color: #5a3e2b;
    color: #fff;
    border: none;
    padding: 10px 20px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s, transform 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.genre-button:hover {
    background-color: #d4a373;
    color: #d4a373;
    transform: scale(1.05);
}

.genre-button.active {
    background-color: #d4a373;
    color: white;
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.book {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
}

.book-item {
    background-color: #fff;
    padding: 15px;
    width: 150px;
    text-align: center;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s, transform 0.2s;
}

.book-item:hover {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(-5px);
}

.book-item h3 {
    font-size: 18px;
    margin-bottom: 5px;
    color: #5a3e2b;
}

.book-item p {
    font-size: 14px;
    color: #d4a373;
}

.search-banner {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background-color: #f5e6cc;
    background-image: linear-gradient(to right, #d4a373, #d4a373);
}

.image-container {
    text-align: center;
    max-width: 800px;
    width: 100%;
}

.image-container img {
    width: 100%;
    height: auto;
    border-radius: 10px;
    object-fit: cover;
}

.genres {
    margin: 20px auto;
    max-width: 600px;
    text-align: center;
}

.genres button {
    margin: 5px;
    padding: 10px 15px;
    background-color: #5a3e2b;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.genres button:hover {
    background-color: #d4a373;
    color: #d4a373;
}

.popular-books {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
}

.popular-books .book-item {
    background-color: #fff;
    padding: 15px;
    width: 150px;
    text-align: center;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s, transform 0.2s;
}

.popular-books .book-item:hover {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transform: translateY(-5px);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫–Ω–∏–≥ */
.paid-badge {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #FF5722;
    color: white;
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: bold;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.book-item {
    position: relative;
}

.payment-qr {
    max-width: 200px;
    margin: 0 auto;
    display: block;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Ñ–æ—Ä–º—ã */
.auth-tabs {
    margin-bottom: 20px;
}

.auth-tabs .nav-link {
    color: #5a3e2b;
}

.auth-tabs .nav-link.active {
    background-color: #d4a373;
    color: white;
    border-color: #d4a373;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è QR-–∫–æ–¥–∞ */
.qr-container {
    position: relative;
    display: inline-block;
    margin: 0 auto;
}

.qr-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 5px;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã */
.success-animation {
    margin: 0 auto;
}

.checkmark {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: block;
    stroke-width: 2;
    stroke: #4bb71b;
    stroke-miterlimit: 10;
    box-shadow: inset 0px 0px 0px #4bb71b;
    animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
    margin: 0 auto;
}

.checkmark__circle {
    stroke-dasharray: 166;
    stroke-dashoffset: 166;
    stroke-width: 2;
    stroke-miterlimit: 10;
    stroke: #4bb71b;
    fill: none;
    animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

.checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
}

@keyframes stroke {
    100% {
        stroke-dashoffset: 0;
    }
}

@keyframes scale {
    0%, 100% {
        transform: none;
    }
    50% {
        transform: scale3d(1.1, 1.1, 1);
    }
}

@keyframes fill {
    100% {
        box-shadow: inset 0px 0px 0px 30px #4bb71b;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.loading-overlay.show {
    opacity: 1;
    pointer-events: all;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #d4a373;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
.modal-content {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
}

.modal-header {
    background-color: #d4a373;
    color: white;
    border-bottom: none;
}

.modal-header .btn-close {
    color: white;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∞–ª—Ç–∞–π–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
.notification-toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4bb71b;
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    z-index: 9999;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.5s ease;
}

.notification-toast.show {
    transform: translateY(0);
    opacity: 1;
}
    </style>
</head>
<body>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º –æ–≤–µ—Ä–ª–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—Å—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="notification-toast" id="notificationToast">
        <div class="notification-content">–û–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!</div>
    </div>
    
    <div id="login-section">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="#">üìö –û–Ω–ª–∞–π–Ω –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#register">–¢—ñ—Ä–∫–µ–ª—É</a>
                        </li>                    
                        <li class="nav-item"><a class="nav-link" href="#contact">–ë–∞–π–ª–∞–Ω—ã—Å</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <header class="hero">
            <h1>–û–Ω–ª–∞–π–Ω –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞“ì–∞ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!</h1>
            <p>–ö—ñ—Ç–∞–ø—Ç–∞—Ä ”ô–ª–µ–º—ñ–Ω –∞—à—ã“£—ã–∑</p>
        </header>

        <section id="register" class="container my-5 form-container">
            <div class="card p-4 shadow" style="width: 100%; max-width: 400px;">
                <ul class="nav nav-tabs auth-tabs" id="authTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login-content" type="button" role="tab" aria-controls="login-content" aria-selected="true">–ö—ñ—Ä—É</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-content" type="button" role="tab" aria-controls="register-content" aria-selected="false">–¢—ñ—Ä–∫–µ–ª—É</button>
                    </li>
                </ul>
                <div class="tab-content" id="authTabsContent">
                    <!-- –í–∫–ª–∞–¥–∫–∞ –≤—Ö–æ–¥–∞ -->
                    <div class="tab-pane fade show active" id="login-content" role="tabpanel" aria-labelledby="login-tab">
                        <h2 class="text-center mt-3">–ö—ñ—Ä—É</h2>
                        <form class="row g-3 mt-3" onsubmit="return validateLogin()">
                            <div class="col-12">
                                <label for="login-email" class="form-label">–õ–æ–≥–∏–Ω:</label>
                                <input type="text" class="form-control" id="login-email" required>
                            </div>
                            <div class="col-12">
                                <label for="login-password" class="form-label">“ö“±–ø–∏—è —Å”©–∑:</label>
                                <input type="password" class="form-control" id="login-password" required>
                            </div>
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary w-100">–ö—ñ—Ä—É</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                    <div class="tab-pane fade" id="register-content" role="tabpanel" aria-labelledby="register-tab">
                        <h2 class="text-center mt-3">–¢—ñ—Ä–∫–µ–ª—É</h2>
                        <form class="row g-3 mt-3" onsubmit="return registerUser()">
                            <div class="col-12">
                                <label for="register-name" class="form-label">–ê—Ç—ã-–∂”©–Ω—ñ:</label>
                                <input type="text" class="form-control" id="register-name" required>
                            </div>
                            <div class="col-12">
                                <label for="register-email" class="form-label">–≠-–ø–æ—à—Ç–∞:</label>
                                <input type="email" class="form-control" id="register-email" required>
                            </div>
                            <div class="col-12">
                                <label for="register-password" class="form-label">“ö“±–ø–∏—è —Å”©–∑:</label>
                                <input type="password" class="form-control" id="register-password" required>
                            </div>
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary w-100">–¢—ñ—Ä–∫–µ–ª—É</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="main-section">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="#">üìö –û–Ω–ª–∞–π–Ω –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <li class="nav-item">
                                <a class="nav-link" href="#" onclick="showAllBooks()">–ö–∞—Ç–∞–ª–æ–≥</a>
                            </li>                            
                        </li>                    
                        <li class="nav-item"><a class="nav-link" href="#contact">–ë–∞–π–ª–∞–Ω—ã—Å</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <header class="hero">
            <h1>–ö–∞—Ç–∞–ª–æ–≥ –±–µ—Ç—ñ–Ω–µ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!</h1>
            <p>–ö—ñ—Ç–∞–ø—Ç–∞—Ä ”ô–ª–µ–º—ñ–Ω –∑–µ—Ä—Ç—Ç–µ“£—ñ–∑</p>
        </header>

        <section id="search-banner" class="search-banner">
            <div class="search-bar-container">
                <input type="text" id="search-bar" placeholder="–ö—ñ—Ç–∞–ø—Ç—ã“£ –∞—Ç—ã–Ω –Ω–µ–º–µ—Å–µ –∞–≤—Ç–æ—Ä–¥—ã —ñ–∑–¥–µ“£—ñ–∑..." onkeyup="searchBooks()">
                <button type="button" class="search-button">üîç</button>
            </div>
        </section>

        <section id="popular-books" class="container my-5">
            <h2 class="text-center">üìö –¢–∞–Ω—ã–º–∞–ª –∫—ñ—Ç–∞–ø—Ç–∞—Ä</h2>
            <div class="book-list" id="popular-books-container"></div>
        </section>        
        
        
        <section id="genre-selection" class="container my-5">
            <h2 class="text-center">üé≠ –ñ–∞–Ω—Ä–¥—ã —Ç–∞“£–¥–∞“£—ã–∑</h2>
            <div class="genre-buttons text-center">
            </div>
        </section>
        


        <div class="genres" id="genres">
            
        </div>

        <div class="book-list" id="book-list">
            
        </div>


        <section id="contact" class="container my-5">
            <h2 class="text-center">–ë–∞–π–ª–∞–Ω—ã—Å</h2>
            <p class="text-center">–ë—ñ–∑–¥—ñ“£ –º–µ–∫–µ–Ω –∂–∞–π—ã–º—ã–∑: –ê–ª–º–∞—Ç—ã “õ., –ì–æ–≥–æ–ª—è –∫-—Å—ñ, 114-“Ø–π</p>
            <p class="text-center">–ë–∞–π–ª–∞–Ω—ã—Å —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–æ–º–µ—Ä—ñ: +7 (747) 565-89-14</p>
        </section>
    </div>

    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–Ω–∏–≥–µ -->
    <div class="modal fade" id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookModalLabel">–ö—ñ—Ç–∞–ø —Ç—É—Ä–∞–ª—ã —Ç–æ–ª—ã“ì—ã—Ä–∞“õ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5 id="modal-book-title"></h5>
                    <p id="modal-book-author"></p>
                    <p id="modal-book-description"></p>
                    <div id="modal-book-price-info"></div>
                    <div id="modal-book-action-container">
                        <a id="modal-book-link" href="#" target="_blank" class="btn btn-primary">–ö—ñ—Ç–∞–ø—Ç—ã –æ“õ—É</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–ø–ª–∞—Ç—ã -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">–ö—ñ—Ç–∞–ø—Ç—ã —Å–∞—Ç—ã–ø –∞–ª—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <h5 id="payment-book-title"></h5>
                    <p id="payment-book-price"></p>
                    <p>–¢”©–ª–µ–º –∂–∞—Å–∞—É “Ø—à—ñ–Ω QR –∫–æ–¥—Ç—ã —Å–∫–∞–Ω–µ—Ä–ª–µ“£—ñ–∑:</p>
                    <div class="qr-container">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://example.com/payment" alt="Payment QR Code" class="payment-qr">
                        <div class="qr-overlay d-none">
                            <div class="spinner-border text-light" role="status">
                                <span class="visually-hidden">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted">QR –∫–æ–¥—Ç—ã —Å–∫–∞–Ω–µ—Ä–ª–µ–≥–µ–Ω–¥–µ, —Ç”©–ª–µ–º –±–µ—Ç—ñ –∞—à—ã–ª–∞–¥—ã</p>
                        <div class="d-flex justify-content-center gap-2">
                            <button id="simulate-scan" class="btn btn-info">QR –°–∫–∞–Ω–µ—Ä–ª–µ—É–¥—ñ –∏–º–∏—Ç–∞—Ü–∏—è–ª–∞—É</button>
                            <button id="confirm-payment" class="btn btn-success">–¢”©–ª–µ–º–¥—ñ —Ä–∞—Å—Ç–∞—É</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="success-animation">
                        <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                        </svg>
                    </div>
                    <h4 class="mt-3">–¢”©–ª–µ–º —Å”ô—Ç—Ç—ñ –∞—è“õ—Ç–∞–ª–¥—ã!</h4>
                    <p>–†–∞—Ö–º–µ—Ç! –ö—ñ—Ç–∞–ø —Å–∞—Ç—ã–ø –∞–ª—ã–Ω–¥—ã.</p>
                    <button id="success-close" class="btn btn-primary mt-2">–ñ–∞–±—É</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.io –¥–ª—è —Ä–µ–∞–ª—Ç–∞–π–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
        const socket = io();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –≤ URL
        const urlParams = new URLSearchParams(window.location.search);
        const paymentSuccess = urlParams.get('payment_success');
        const sessionId = urlParams.get('sessionId');
        
        if (paymentSuccess === 'true' && sessionId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
            setTimeout(() => {
                showNotification('–¢”©–ª–µ–º —Å”ô—Ç—Ç—ñ –∞—è“õ—Ç–∞–ª–¥—ã! –ö—ñ—Ç–∞–ø —Å–∞—Ç—ã–ø –∞–ª—ã–Ω–¥—ã.');
            }, 1000);
        }
        
        // –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
        const users = [
            { email: 'aiibidildaeva@gmail.com', password: 'admin', name: '–ê–¥–º–∏–Ω' }
        ];
        
        let currentUser = null;
        let currentUserId = null;
        
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        const purchasedBooks = {};
        
        // –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
        const books = [
            { 
                title: "–ú–∞—Ö–∞–±–±–∞—Ç, “õ—ã–∑—ã“õ –º–æ–ª –∂—ã–ª–¥–∞—Ä", 
                author: "”ò–∑—ñ–ª—Ö–∞–Ω –ù“±—Ä—à–∞–π—ã“õ–æ–≤", 
                genre: "–†–æ–º–∞–Ω—Ç–∏–∫–∞", 
                description: "–ú–∞—Ö–∞–±–±–∞—Ç, “õ—ã–∑—ã“õ –º–æ–ª –∂—ã–ª–¥–∞—Ä ‚Äî ”ò–∑—ñ–ª—Ö–∞–Ω –ù“±—Ä—à–∞–π—ã“õ–æ–≤—Ç—ã“£ “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω—ñ“£ –∫–ª–∞—Å—Å–∏–∫–∞—Å—ã–Ω–∞ –∞–π–Ω–∞–ª“ì–∞–Ω —Ç—É—ã–Ω–¥—ã—Å—ã. –ë“±–ª —Ä–æ–º–∞–Ω 1967 –∂—ã–ª—ã –∞–ª“ì–∞—à —Ä–µ—Ç –∂–∞—Ä—ã“õ –∫”©—Ä—ñ–ø, “õ–∞–∑–∞“õ –∂–∞—Å—Ç–∞—Ä—ã–Ω—ã“£ —Å“Ø–π—ñ–∫—Ç—ñ –∫—ñ—Ç–∞–±—ã–Ω–∞ –∞–π–Ω–∞–ª–¥—ã. –†–æ–º–∞–Ω–Ω—ã“£ –±–∞—Å—Ç—ã –∫–µ–π—ñ–ø–∫–µ—Ä–ª–µ—Ä—ñ ‚Äî —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä –º–µ–Ω –∂–∞—Å –∞–¥–∞–º–¥–∞—Ä–¥—ã“£ –º–∞—Ö–∞–±–±–∞—Ç, –¥–æ—Å—Ç—ã“õ, ”©–º—ñ—Ä–¥—ñ“£ —Ç“Ø—Ä–ª—ñ “õ–∏—ã–Ω–¥—ã“õ—Ç–∞—Ä—ã–Ω –∂–µ“£—ñ–ø —à—ã“ì—É –∂–æ–ª—ã–Ω–¥–∞“ì—ã –∫“Ø—Ä–µ—Å—ñ. –ñ–∞–∑—É—à—ã –∂–∞—Å—Ç–∞—Ä–¥—ã“£ —ñ—à–∫—ñ —Å–µ–∑—ñ–º–¥–µ—Ä—ñ–Ω, –æ–ª–∞—Ä–¥—ã“£ –∞–¥–∞–º–≥–µ—Ä—à—ñ–ª—ñ–∫, –∞–¥–∞–ª–¥—ã“õ, –º–∞—Ö–∞–±–±–∞—Ç —Ç—É—Ä–∞–ª—ã —Ç“Ø—Å—ñ–Ω—ñ–∫—Ç–µ—Ä—ñ–Ω —Ç–µ—Ä–µ“£ ”ô—Ä—ñ —à—ã–Ω–∞–π—ã —Å—É—Ä–µ—Ç—Ç–µ–π–¥—ñ.",
                link: "http://dev-s.balatili.kz/uploads/books/e3c0b8aca955a2e22aa53f053550270c/%D0%9C%D0%B0%D1%85%D0%B0%D0%B1%D0%B1%D0%B0%D1%82%20%D2%9B%D1%8B%D0%B7%D1%8B%D2%9B%20%D0%BC%D0%BE%D0%BB%20%D0%B6%D1%8B%D0%BB%D0%B4%D0%B0%D1%80.pdf", 
                image: "https://simg.marwin.kz/media/catalog/product/cache/41deb699a7fea062a8915debbbb0442c/m/a/nrshayyov_mahabbat_yzy_mol_jyldar.jpg",
                isPaid: true,
                price: 1200
            },
            { 
                title: "–ê–±–∞–π –ñ–æ–ª—ã", 
                author: "–ú“±—Ö—Ç–∞—Ä ”ò—É–µ–∑–æ–≤", 
                genre: "–ö–ª–∞—Å—Å–∏–∫–∞", 
                description: "–ê–±–∞–π –∂–æ–ª—ã ‚Äî “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω—ñ“£ “±–ª—ã —à—ã“ì–∞—Ä–º–∞–ª–∞—Ä—ã–Ω—ã“£ –±—ñ—Ä—ñ, “õ–∞–∑–∞“õ —Ö–∞–ª“õ—ã–Ω—ã“£ –∫–ª–∞—Å—Å–∏–∫–∞–ª—ã“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω—ñ“£ —Å–∏–º–≤–æ–ª—ã –∂”ô–Ω–µ “õ–∞–∑–∞“õ—Ç—ã“£ “±–ª—ã –∞“õ—ã–Ω—ã, –æ–π—à—ã–ª—ã –ê–±–∞–π “ö“±–Ω–∞–Ω–±–∞–π“±–ª—ã–Ω—ã“£ ”©–º—ñ—Ä—ñ –º–µ–Ω —à—ã“ì–∞—Ä–º–∞—à—ã–ª—ã“ì—ã–Ω–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω —Ä–æ–º–∞–Ω-—ç–ø–æ–ø–µ—è. –ê–±–∞–π –∂–æ–ª—ã ‚Äî —Ç”©—Ä—Ç —Ç–æ–º–Ω–∞–Ω —Ç“±—Ä–∞—Ç—ã–Ω –∫“Ø—Ä–¥–µ–ª—ñ —ç–ø–æ–ø–µ—è, –∞–ª“ì–∞—à —Ä–µ—Ç 1942 –∂—ã–ª—ã –∂–∞—Ä–∏—è–ª–∞–Ω“ì–∞–Ω. –ú“±—Ö—Ç–∞—Ä ”ò—É–µ–∑–æ–≤ –æ—Å—ã —à—ã“ì–∞—Ä–º–∞—Å—ã–Ω–¥–∞ –ê–±–∞–π–¥—ã“£ –∂–µ–∫–µ ”©–º—ñ—Ä—ñ–Ω, –æ–Ω—ã“£ –¥“Ø–Ω–∏–µ—Ç–∞–Ω—ã–º—ã–Ω, —à—ã“ì–∞—Ä–º–∞—à—ã–ª—ã“ì—ã–Ω, “õ–∞–∑–∞“õ “õ–æ“ì–∞–º—ã–Ω–¥–∞“ì—ã ”©–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –∂”ô–Ω–µ —Å–æ–ª –∫–µ–∑–µ“£–¥–µ–≥—ñ —Ç–∞—Ä–∏—Ö–∏ –æ“õ–∏“ì–∞–ª–∞—Ä–¥—ã —Ç–µ—Ä–µ“£ –±–µ–π–Ω–µ–ª–µ–π–¥—ñ.",
                link: "https://predmet.kz/adebiet/%D0%BA%D1%96%D1%82%D0%B0%D0%BF%D1%82%D0%B0%D1%80/%D0%90%D0%B1%D0%B0%D0%B9%20%D0%B6%D0%BE%D0%BB%D1%8B.1%20%D0%BA%D1%96%D1%82%D0%B0%D0%BF.pdf", 
                image: "https://s.f.kz/prod/1540/1539578_1000.jpg",
                isPaid: false,
                price: 0
            },
            { 
                title: "“ö–∞–Ω –º–µ–Ω –¢–µ—Ä", 
                author: "”ò–±–¥—ñ–∂”ô–º—ñ–ª –ù“±—Ä–ø–µ–π—ñ—Å–æ–≤", 
                genre: "–ö–ª–∞—Å—Å–∏–∫–∞", 
                description: "“ö–∞–Ω –º–µ–Ω —Ç–µ—Ä ‚Äî “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω—ñ“£ –∫”©—Ä–Ω–µ–∫—Ç—ñ —à—ã“ì–∞—Ä–º–∞–ª–∞—Ä—ã–Ω—ã“£ –±—ñ—Ä—ñ, –∂–∞–∑—É—à—ã ”ò–±–¥—ñ–∂”ô–º—ñ–ª –ù“±—Ä–ø–µ–π—ñ—Å–æ–≤—Ç—ñ“£ –µ“£ —Ç–∞–Ω—ã–º–∞–ª —Ç—É—ã–Ω–¥—ã—Å—ã. –†–æ–º–∞–Ω –∞–ª“ì–∞—à —Ä–µ—Ç 1970 –∂—ã–ª—ã –∂–∞—Ä–∏—è–ª–∞–Ω“ì–∞–Ω –∂”ô–Ω–µ “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω—ñ“£ –∫–ª–∞—Å—Å–∏–∫–∞–ª—ã“õ —Ç—É—ã–Ω–¥—ã–ª–∞—Ä—ã–Ω—ã“£ “õ–∞—Ç–∞—Ä—ã–Ω–∞ –∫—ñ—Ä–µ–¥—ñ. –®—ã“ì–∞—Ä–º–∞ ”©–∑—ñ–Ω—ñ“£ —Ç–µ—Ä–µ“£ ”ô–ª–µ—É–º–µ—Ç—Ç—ñ–∫ –∂”ô–Ω–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è–ª—ã“õ –º–∞–∑–º“±–Ω—ã–º–µ–Ω –µ—Ä–µ–∫—à–µ–ª–µ–Ω–µ–¥—ñ, “õ–∞–∑–∞“õ —Ö–∞–ª“õ—ã–Ω—ã“£ “õ–∏—ã–Ω –∫–µ–∑–µ“£–¥–µ—Ä—ñ –º–µ–Ω —Ö–∞–ª—ã“õ—Ç—ã“õ —Ç–∞“ì–¥—ã—Ä–¥—ã“£ —à—ã–Ω–∞–π—ã —Å—É—Ä–µ—Ç—ñ–Ω –∫”©—Ä—Å–µ—Ç–µ–¥—ñ.",
                link: "https://adebiportal.kz/upload/iblock/0d5/0d581f528880c6ae74bf3685d2ef0add.pdf", 
                image: "https://balkhash.goo.kz/files/blog/1674232545216.jpg",
                isPaid: true,
                price: 1500
            },
            { 
               title: "“∞—à“õ–∞–Ω “±—è", 
               author: "–ë–∞—É—ã—Ä–∂–∞–Ω –ú–æ–º—ã—à“±–ª—ã", 
               genre: "”ò–¥–µ–±–∏", 
               link: "https://adebiportal.kz/upload/iblock/5e1/5e13518fb629e466f3a930c56af4d672.pdf", 
               description: "“∞—à“õ–∞–Ω “±—è ‚Äî “õ–∞–∑–∞“õ –∂–∞–∑—É—à—ã—Å—ã –ë–∞—É—ã—Ä–∂–∞–Ω –ú–æ–º—ã—à“±–ª—ã–Ω—ã“£ ”©–º—ñ—Ä—ñ –º–µ–Ω —à—ã“ì–∞—Ä–º–∞—à—ã–ª—ã“ì—ã–Ω –¥”ô—Ä—ñ–ø—Ç–µ–π—Ç—ñ–Ω –∫”©—Ä–∫–µ–º —Ç—É—ã–Ω–¥—ã. –ë“±–ª —à—ã“ì–∞—Ä–º–∞ –∞–ª“ì–∞—à —Ä–µ—Ç 1966 –∂—ã–ª—ã –∂–∞—Ä—ã“õ –∫”©—Ä–≥–µ–Ω –∂”ô–Ω–µ –ë–∞—É—ã—Ä–∂–∞–Ω –ú–æ–º—ã—à“±–ª—ã–Ω—ã“£ —à—ã“ì–∞—Ä–º–∞–ª–∞—Ä—ã–Ω—ã“£ —ñ—à—ñ–Ω–¥–µ–≥—ñ –µ“£ —Ç–∞–Ω—ã–º–∞–ª—ã –±–æ–ª—ã–ø —Ç–∞–±—ã–ª–∞–¥—ã. –†–æ–º–∞–Ω –∂–∞–∑—É—à—ã–Ω—ã“£ ”©–∑ –±–∞–ª–∞–ª—ã“õ —à–∞“ì—ã, –∞—Ç–∞-–∞–Ω–∞—Å—ã –∂”ô–Ω–µ ”©—Å–∫–µ–Ω –æ—Ä—Ç–∞—Å—ã —Ç—É—Ä–∞–ª—ã –±–µ–π–Ω–µ–ª—ñ —Ç“Ø—Ä–¥–µ –±–∞—è–Ω–¥–∞–ª–∞–¥—ã.",
               image: "https://frankfurt.apollo.olxcdn.com/v1/files/a77ofbi5geuz-KZ/image",
               isPaid: false,
               price: 0
            },
            {
               title: "–ë–∞“õ—ã—Ç—Å—ã–∑ –ñ–∞–º–∞–ª",
               author: "–ú—ñ—Ä–∂–∞“õ–æ–≤ –î—É–ª–∞—Ç“±–ª—ã", 
               genre: "–†–æ–º–∞–Ω—Ç–∏–∫–∞", 
               link: "http://dev-s.balatili.kz/uploads/books/c440d23f5b0133c2199ed66e3fb01ffd/%D0%91%D0%90%D2%9A%D0%AB%D0%A2%D0%A1%D0%AB%D0%97%20%D0%96%D0%90%D0%9C%D0%90%D0%9B%20-%20%D0%A0%D0%BE%D0%BC%D0%B0%D0%BD.pdf", 
               description: "–ë–∞“õ—ã—Ç—Å—ã–∑ –ñ–∞–º–∞–ª ‚Äì –±“±–ª “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω—ñ“£ –∫–ª–∞—Å—Å–∏–∫–∞–ª—ã“õ —Ç—É—ã–Ω–¥—ã–ª–∞—Ä—ã–Ω—ã“£ –±—ñ—Ä—ñ, –∂–∞–∑—É—à—ã –ú—ñ—Ä–∂–∞“õ—ã–ø –î—É–ª–∞—Ç“±–ª—ã–Ω—ã“£ –µ“£ ”ô–π–≥—ñ–ª—ñ —à—ã“ì–∞—Ä–º–∞–ª–∞—Ä—ã–Ω—ã“£ “õ–∞—Ç–∞—Ä—ã–Ω–∞ –∂–∞—Ç–∞–¥—ã. –†–æ–º–∞–Ω –∞–ª“ì–∞—à —Ä–µ—Ç 1910 –∂—ã–ª—ã –∂–∞—Ä—ã“õ –∫”©—Ä–¥—ñ. –®—ã“ì–∞—Ä–º–∞–Ω—ã“£ –±–∞—Å—Ç—ã —Ç–∞“õ—ã—Ä—ã–±—ã ‚Äî “õ–æ“ì–∞–º–¥—ã“õ “õ–∞–π—à—ã–ª—ã“õ—Ç–∞—Ä –º–µ–Ω –∞–¥–∞–º–Ω—ã“£ —ñ—à–∫—ñ ”ô–ª–µ–º—ñ–Ω—ñ“£ –∫“Ø—Ä–µ—Å—ñ, —Å–æ–Ω–¥–∞–π-–∞“õ ”ô–π–µ–ª–¥–µ—Ä–¥—ñ“£ “õ–æ“ì–∞–º–¥—ã“õ –æ—Ä–Ω—ã –º–µ–Ω –±–æ—Å—Ç–∞–Ω–¥—ã“ì—ã –º”ô—Å–µ–ª–µ–ª–µ—Ä—ñ–Ω–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω.",
               image: "https://static.insales-cdn.com/images/products/1/4844/877253356/M_Dulatov_Baqytsyz_Jamal_pocketbook_COVER-16_curv.png",
               isPaid: true,
               price: 1000
            },
            {
               title: "–ê“õ–±—ñ–ª–µ–∫", 
               author: "–ñ“Ø—Å—ñ–ø–±–µ–∫ –ê–π–º–∞—É—ã—Ç–æ–≤", 
               genre: "–ö–ª–∞—Å—Å–∏–∫–∞", 
               link: "https://sauap.org/wp-content/uploads/2016/08/Zhusipbek_Aimauytov_Akbilek.pdf", 
               description: "–ê“õ–±—ñ–ª–µ–∫ ‚Äî “õ–∞–∑–∞“õ –∂–∞–∑—É—à—ã—Å—ã –ñ“Ø—Å—ñ–ø–±–µ–∫ –ê–π–º–∞—É—ã—Ç–æ–≤—Ç—ã“£ 1927 –∂—ã–ª—ã –∂–∞–∑—ã–ª“ì–∞–Ω —Ä–æ–º–∞–Ω—ã. –ë“±–ª —à—ã“ì–∞—Ä–º–∞ “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω–¥–µ ”ô–π–µ–ª–¥–µ—Ä —Ç–∞“ì–¥—ã—Ä—ã, –æ—Ç–±–∞—Å—ã–ª—ã“õ ”©–º—ñ—Ä –º–µ–Ω ”ô–ª–µ—É–º–µ—Ç—Ç—ñ–∫ –º”ô—Å–µ–ª–µ–ª–µ—Ä–¥—ñ —Ç–µ—Ä–µ“£ “õ–æ–∑“ì–∞–π—Ç—ã–Ω —à—ã“ì–∞—Ä–º–∞–ª–∞—Ä–¥—ã“£ –±—ñ—Ä—ñ –±–æ–ª—ã–ø —Ç–∞–±—ã–ª–∞–¥—ã.",
               image: "https://sun9-69.userapi.com/impg/S9w-ZYE_vb3QtLUgsyVNdKOw1no-z7Jz4gWEsQ/cfDpfQnySe4.jpg?size=800x1188&quality=95&sign=2d179e5584f43f6c08985a9a8d9ce6dc&c_uniq_tag=SsAVXpFxo4WJL8u3j2P2GwfY_dNu-lTViTDy4OrUl1E&type=album",
               isPaid: false,
               price: 0
            },
            {
               title: "“ö–∞“ª–∞—Ä", 
               author: "–Ü–ª–∏—è—Å –ï—Å–µ–Ω–±–µ—Ä–ª–∏–Ω", 
               genre: "–¢–∞—Ä–∏—Ö–∏", 
               link: "https://pushkinlibrary.kz/exhibitions/esenberlin/docs/3.pdf", 
               description: "“ö–∞“ª–∞—Ä ‚Äî “õ–∞–∑–∞“õ –∂–∞–∑—É—à—ã—Å—ã –Ü–ª–∏—è—Å –ñ–∞–Ω—Å“Ø–≥—ñ—Ä–æ–≤—Ç—ã“£ 1936 –∂—ã–ª—ã –∂–∞–∑—ã–ª“ì–∞–Ω —Ä–æ–º–∞–Ω—ã. –ë“±–ª —à—ã“ì–∞—Ä–º–∞ “õ–∞–∑–∞“õ ”ô–¥–µ–±–∏–µ—Ç—ñ–Ω–¥–µ ”ô–ª–µ—É–º–µ—Ç—Ç—ñ–∫ –∂”ô–Ω–µ —Å–∞—è—Å–∏ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä–¥—ã —Ç–µ—Ä–µ“£ “õ–æ–∑“ì–∞–π—Ç—ã–Ω –º–∞“£—ã–∑–¥—ã —à—ã“ì–∞—Ä–º–∞–ª–∞—Ä–¥—ã“£ –±—ñ—Ä—ñ –±–æ–ª—ã–ø —Ç–∞–±—ã–ª–∞–¥—ã. –†–æ–º–∞–Ω–Ω—ã“£ –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ “õ–∞–∑–∞“õ —Ö–∞–ª“õ—ã–Ω—ã“£ “±–ª—Ç—Ç—ã“õ —Ç–∞“ì–¥—ã—Ä—ã, —Å–æ—Ü–∏–∞–ª–∏—Å—Ç—ñ–∫ “õ–æ“ì–∞–º–Ω—ã“£ “õ–∞–ª—ã–ø—Ç–∞—Å—É –∫–µ–∑–µ“£—ñ, –µ“£–±–µ–∫ –∞–¥–∞–º–¥–∞—Ä—ã–Ω—ã“£ “õ–∏—ã–Ω—à—ã–ª—ã“ì—ã –∂”ô–Ω–µ “±–ª—Ç—Ç—ã“õ —Å–µ–∑—ñ–º–¥–µ—Ä –∂–∞–π–ª—ã –º”ô—Å–µ–ª–µ–ª–µ—Ä –∂–∞—Ç—ã—Ä.",
               image: "https://sun9-62.userapi.com/impf/c638927/v638927783/557a/9_ws_YkAJxw.jpg?size=582x807&quality=96&sign=593f5a08bab1259444179136179d9809&c_uniq_tag=PYg1a_Hvtz8sGncyjPDwi0mZkMdNtimQKC22iqtMQNg&type=album",
               isPaid: true,
               price: 1800
            },
            {
               title: "–ñ—É—Å–∞–Ω –∏—ñ—Å—ñ", 
               author: "–°–∞–π—ã–Ω –ú“±—Ä–∞—Ç–±–µ–∫–æ–≤", 
               genre: "–¢–∞—Ä–∏—Ö–∏", 
               link: "https://pushkinlibrary.kz/exhibitions/Muratbekov_kaz/images/Muratbekov_Zhusan_iisi.pdf", 
               description: "–ñ—É—Å–∞–Ω –∏—Å—ñ ‚Äî “õ–∞–∑–∞“õ –∂–∞–∑—É—à—ã—Å—ã –°“±–ª—Ç–∞–Ω”ô–ª—ñ –ë–∞–ª“ì–∞–±–∞–µ–≤—Ç—ã“£ 2006 –∂—ã–ª—ã –∂–∞–∑—ã–ª“ì–∞–Ω —Ä–æ–º–∞–Ω—ã. –ë“±–ª —à—ã“ì–∞—Ä–º–∞ “õ–∞–∑–∞“õ “õ–æ“ì–∞–º—ã–Ω—ã“£ ”©—Ç–∫–µ–Ω –º–µ–Ω “õ–∞–∑—ñ—Ä–≥—ñ –∫–µ–∑–µ“£—ñ–Ω–¥–µ–≥—ñ –∫“Ø—Ä–¥–µ–ª—ñ –º”ô—Å–µ–ª–µ–ª–µ—Ä–¥—ñ “õ–∞—Ä–∞—Å—Ç—ã—Ä—ã–ø, —Å–æ–Ω—ã–º–µ–Ω “õ–∞—Ç–∞—Ä –∞–¥–∞–º –∂–∞–Ω—ã–Ω–¥–∞“ì—ã —Ç–µ—Ä–µ“£ —Å–µ–∑—ñ–º–¥–µ—Ä –º–µ–Ω —Ä—É—Ö–∞–Ω–∏ —ñ–∑–¥–µ–Ω—ñ—Å—Ç–µ—Ä–≥–µ –∞—Ä–Ω–∞–ª–∞–¥—ã. –†–æ–º–∞–Ω–Ω—ã“£ –Ω–µ–≥—ñ–∑–≥—ñ —Ç–∞“õ—ã—Ä—ã–±—ã ‚Äî –∞–¥–∞–º–Ω—ã“£ ”©–∑ –±–æ–ª–º—ã—Å—ã–Ω —Ç“Ø—Å—ñ–Ω—ñ–ø, —ñ—à–∫—ñ –∂–∞–Ω –¥“Ø–Ω–∏–µ—Å—ñ–Ω–¥–µ —Ç—ã–Ω—ã—à—Ç—ã“õ —Ç–∞–±—É“ì–∞ “±–º—Ç—ã–ª—É—ã.",
               image: "https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1548241221i/43687798.jpg",
               isPaid: false,
               price: 0
            }
        ];

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥ —Å —É—á–µ—Ç–æ–º —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–Ω–æ—Å—Ç–∏
        const popularBooks = [
            { 
                title: "–ú–∞—Ö–∞–±–±–∞—Ç, “õ—ã–∑—ã“õ –º–æ–ª –∂—ã–ª–¥–∞—Ä", 
                author: "”ò–∑—ñ–ª—Ö–∞–Ω –ù“±—Ä—à–∞–π—ã“õ–æ–≤", 
                genre: "–†–æ–º–∞–Ω—Ç–∏–∫–∞", 
                description: "–ë“±–ª –∫—ñ—Ç–∞–ø –∂–∞—Å—Ç–∞—Ä–¥—ã“£ –º–∞—Ö–∞–±–±–∞—Ç—ã –º–µ–Ω ”©–º—ñ—Ä–ª—ñ–∫ “õ–∏—ã–Ω–¥—ã“õ—Ç–∞—Ä—ã–Ω —Å—É—Ä–µ—Ç—Ç–µ–π–¥—ñ.",
                link: "http://dev-s.balatili.kz/uploads/books/e3c0b8aca955a2e22aa53f053550270c/%D0%9C%D0%B0%D1%85%D0%B0%D0%B1%D0%B1%D0%B0%D1%82%20%D2%9B%D1%8B%D0%B7%D1%8B%D2%9B%20%D0%BC%D0%BE%D0%BB%20%D0%B6%D1%8B%D0%BB%D0%B4%D0%B0%D1%80.pdf", 
                image: "https://simg.marwin.kz/media/catalog/product/cache/41deb699a7fea062a8915debbbb0442c/m/a/nrshayyov_mahabbat_yzy_mol_jyldar.jpg",
                isPaid: true,
                price: 1200
            },
            { 
                title: "–ê–±–∞–π –∂–æ–ª—ã", 
                author: "–ú“±—Ö—Ç–∞—Ä ”ò—É–µ–∑–æ–≤", 
                genre: "–ö–ª–∞—Å—Å–∏–∫–∞", 
                description: "“ö–∞–∑–∞“õ—Ç—ã“£ “±–ª—ã –∞“õ—ã–Ω—ã –ê–±–∞–π “ö“±–Ω–∞–Ω–±–∞–π“±–ª—ã —Ç—É—Ä–∞–ª—ã —Ç–∞—Ä–∏—Ö–∏ —Ä–æ–º–∞–Ω.",
                link: "https://example.com/abai-zholy.pdf",
                image: "https://kitap.kz/storage/books/AbaiZholy.jpg",
                isPaid: false,
                price: 0
            }
        ];

        document.addEventListener("DOMContentLoaded", function () {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            fetchBooks();
            displayPopularBooks();
            displayGenres();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ sessionId –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ —Å–µ—Å—Å–∏–∏ –æ–ø–ª–∞—Ç—ã
            if (sessionId) {
                socket.emit('join-payment-session', sessionId);
            }
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã
            socket.on('payment-status-changed', function(data) {
                console.log('–ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞:', data);
                
                // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥
                if (data.status === 'completed' && currentUser) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–∏–≥—É –≤ —Å–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö
                    if (!purchasedBooks[currentUser]) {
                        purchasedBooks[currentUser] = [];
                    }
                    
                    const bookTitle = books.find(book => book.id === data.bookId)?.title;
                    if (bookTitle && !purchasedBooks[currentUser].includes(bookTitle)) {
                        purchasedBooks[currentUser].push(bookTitle);
                        showNotification(`–ö–Ω–∏–≥–∞ "${bookTitle}" —É—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω–∞!`);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–∏–≥
                        const currentGenre = document.querySelector('.genres .genre-button.active')?.textContent;
                        if (currentGenre && currentGenre !== "–ë–∞—Ä–ª—ã“õ –∫—ñ—Ç–∞–ø—Ç–∞—Ä") {
                            filterByGenre(currentGenre);
                        } else {
                            displayBooks(books);
                        }
                    }
                }
            });
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–Ω–∏–≥ —Å —Å–µ—Ä–≤–µ—Ä–∞
        function fetchBooks() {
            fetch('/api/books')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –∫–Ω–∏–≥
                        books.length = 0;
                        books.push(...data.books);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        displayBooks(books);
                        displayGenres();
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥:', error);
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function registerUser() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            showLoading();
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
            fetch('/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name, email, password }),
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.success) {
                    showNotification('–¢—ñ—Ä–∫–µ–ª—É —Å”ô—Ç—Ç—ñ –∞—è“õ—Ç–∞–ª–¥—ã!');
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤—Ö–æ–¥–∞
                    document.getElementById('login-tab').click();
                } else {
                    alert(data.message || '–¢—ñ—Ä–∫–µ–ª—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã.');
                }
            })
            .catch(error => {
                showLoading(false);
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                alert('–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.');
            });
            
            return false;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function validateLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            showLoading();
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Ö–æ–¥
            fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password }),
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.success) {
                    currentUser = data.user.email;
                    currentUserId = data.user.id;
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('main-section').style.display = 'block';
                    
                    fetchUserBooks(currentUserId);
                    
                    showNotification(`“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑, ${data.user.name}!`);
                } else {
                    alert(data.message || '“ö–∞—Ç–µ –ª–æ–≥–∏–Ω –Ω–µ–º–µ—Å–µ “õ“±–ø–∏—è —Å”©–∑!');
                }
            })
            .catch(error => {
                showLoading(false);
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', error);
                alert('–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.');
            });
            
            return false;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function fetchUserBooks(userId) {
            if (!userId) return;
            
            fetch(`/api/user-books/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        if (!purchasedBooks[currentUser]) {
                            purchasedBooks[currentUser] = [];
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–∏–≥–∏ –≤ —Å–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö
                        data.books.forEach(book => {
                            if (!purchasedBooks[currentUser].includes(book.title)) {
                                purchasedBooks[currentUser].push(book.title);
                            }
                        });
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–∏–≥
                        const currentGenre = document.querySelector('.genres .genre-button.active')?.textContent;
                        if (currentGenre && currentGenre !== "–ë–∞—Ä–ª—ã“õ –∫—ñ—Ç–∞–ø—Ç–∞—Ä") {
                            filterByGenre(currentGenre);
                        } else {
                            displayBooks(books);
                        }
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥:', error);
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∫–Ω–∏–≥
        function searchBooks() {
            const query = document.getElementById('search-bar').value.toLowerCase();
            const results = books.filter(book => book.title.toLowerCase().includes(query) || book.author.toLowerCase().includes(query));
            displayBooks(results);
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∂–∞–Ω—Ä—É
        function filterByGenre(genre) {
            const filteredBooks = books.filter(book => book.genre === genre);
            displayBooks(filteredBooks);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥
        function displayBooks(filteredBooks) {
            const bookList = document.getElementById('book-list');
            bookList.innerHTML = '';

            if (filteredBooks.length > 0) {
                filteredBooks.forEach(book => {
                    const bookItem = document.createElement('div');
                    bookItem.classList.add('book-item');
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–π–¥–∂ –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫–Ω–∏–≥
                    let paidBadge = '';
                    if (book.isPaid) {
                        paidBadge = `<span class="paid-badge">${book.price} ‚Ç∏</span>`;
                    }
                    
                    bookItem.innerHTML = `
                        ${paidBadge}
                        <img src="${book.image}" alt="${book.title}" class="img-fluid">
                        <h5>${book.title}</h5>
                        <p>${book.author}</p>
                        <button class="btn btn-secondary" onclick="showBookDetails(${book.id || `'${book.title}'`})">–¢–æ–ª—ã“ì—ã—Ä–∞“õ</button>`;
                    bookList.appendChild(bookItem);
                });
            } else {
                bookList.innerHTML = '<p>–ï—à—Ç–µ“£–µ —Ç–∞–±—ã–ª–º–∞–¥—ã</p>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∫–Ω–∏–≥–∏
        function showBookDetails(bookIdOrTitle) {
            // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–∏–≥—É –ø–æ ID –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫—É
            let book;
            if (typeof bookIdOrTitle === 'number') {
                book = books.find(b => b.id === bookIdOrTitle);
            } else {
                book = books.find(b => b.title === bookIdOrTitle);
            }
            
            if (!book) {
                showNotification('–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏
            showLoading();
            
            setTimeout(() => {
                document.getElementById('modal-book-title').textContent = book.title;
                document.getElementById('modal-book-author').textContent = `–ê–≤—Ç–æ—Ä: ${book.author}`;
                document.getElementById('modal-book-description').textContent = book.description;
                
                const priceInfoElement = document.getElementById('modal-book-price-info');
                const actionContainer = document.getElementById('modal-book-action-container');
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                priceInfoElement.innerHTML = '';
                actionContainer.innerHTML = '';
                
                if (book.isPaid) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—É–ø–∏–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç—Ç—É –∫–Ω–∏–≥—É
                    const hasPurchased = currentUser && purchasedBooks[currentUser] && 
                                        purchasedBooks[currentUser].includes(book.title);
                    
                    if (hasPurchased) {
                        priceInfoElement.innerHTML = '<p class="text-success"><i class="fas fa-check-circle me-2"></i>–°–∞—Ç—ã–ø –∞–ª—ã–Ω“ì–∞–Ω</p>';
                        actionContainer.innerHTML = `<a href="${book.link}" target="_blank" class="btn btn-primary"><i class="fas fa-book-open me-2"></i>–ö—ñ—Ç–∞–ø—Ç—ã –æ“õ—É</a>`;
                    } else {
                        priceInfoElement.innerHTML = `<p>–ë–∞“ì–∞—Å—ã: <strong>${book.price} ‚Ç∏</strong></p>`;
                        actionContainer.innerHTML = `
                            <button class="btn btn-success" onclick="createPaymentSession(${book.id})"><i class="fas fa-shopping-cart me-2"></i>–°–∞—Ç—ã–ø –∞–ª—É</button>
                        `;
                    }
                } else {
                    priceInfoElement.innerHTML = '<p class="text-info"><i class="fas fa-gift me-2"></i>–¢–µ–≥—ñ–Ω –∫—ñ—Ç–∞–ø</p>';
                    actionContainer.innerHTML = `<a href="${book.link}" target="_blank" class="btn btn-primary"><i class="fas fa-book-open me-2"></i>–ö—ñ—Ç–∞–ø—Ç—ã –æ“õ—É</a>`;
                }
                
                showLoading(false);
                const bookModal = new bootstrap.Modal(document.getElementById('bookModal'));
                bookModal.show();
            }, 500);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏
        function createPaymentSession(bookId) {
            if (!currentUser || !currentUserId) {
                alert('–ö—ñ—Ç–∞–ø—Ç—ã —Å–∞—Ç—ã–ø –∞–ª—É “Ø—à—ñ–Ω –∂“Ø–π–µ–≥–µ –∫—ñ—Ä—É “õ–∞–∂–µ—Ç');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏
            showLoading();
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–µ—Å—Å–∏—é
            fetch('/api/payment-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    userId: currentUserId,
                    bookId: bookId
                }),
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.success) {
                    // –ï—Å–ª–∏ –∫–Ω–∏–≥–∞ —É–∂–µ –∫—É–ø–ª–µ–Ω–∞
                    if (data.alreadyPurchased) {
                        showNotification('–ë“±–ª –∫—ñ—Ç–∞–ø –±“±—Ä—ã–Ω —Å–∞—Ç—ã–ø –∞–ª—ã–Ω“ì–∞–Ω');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥
                        fetchUserBooks(currentUserId);
                        
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–Ω–∏–≥–∏
                        const bookModal = bootstrap.Modal.getInstance(document.getElementById('bookModal'));
                        bookModal.hide();
                        
                        return;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
                    showPaymentModal(bookId, data.sessionId, data.userId);
                } else {
                    alert(data.message || '–¢”©–ª–µ–º —Å–µ—Å—Å–∏—è—Å—ã–Ω –∂–∞—Å–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã');
                }
            })
            .catch(error => {
                showLoading(false);
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏:', error);
                alert('–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã
        function showPaymentModal(bookId, sessionId, userId) {
            const book = books.find(b => b.id === bookId);
            
            if (!book) {
                showNotification('–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                return;
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∫–Ω–∏–≥–∏
            const bookModal = bootstrap.Modal.getInstance(document.getElementById('bookModal'));
            bookModal.hide();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏
            showLoading();
            
            setTimeout(() => {
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∫–Ω–∏–≥–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –æ–ø–ª–∞—Ç—ã
                document.getElementById('payment-book-title').textContent = book.title;
                document.getElementById('payment-book-price').textContent = `–ë–∞“ì–∞—Å—ã: ${book.price} ‚Ç∏`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
                const baseUrl = window.location.origin;
                
                // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ —Å–µ—Å—Å–∏–∏ –æ–ø–ª–∞—Ç—ã
                socket.emit('join-payment-session', sessionId);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –æ–ø–ª–∞—Ç—ã
                window.currentPaymentSession = {
                    sessionId: sessionId,
                    bookId: bookId,
                    bookTitle: book.title,
                    status: 'pending'
                };
                
                // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–Ω–∏–≥–∏ –∏ —Å–µ—Å—Å–∏–µ–π
                const paymentUrl = `${baseUrl}/payment.html?book=${encodeURIComponent(book.title)}&price=${book.price}&user=${encodeURIComponent(currentUser)}&session=${sessionId}&bookId=${bookId}&userId=${userId}`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º QR-–∫–æ–¥ —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã
                document.querySelector('.payment-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(paymentUrl)}`;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–º–∏—Ç–∞—Ü–∏–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR-–∫–æ–¥–∞
                document.getElementById('simulate-scan').onclick = function() {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
                    document.querySelector('.qr-overlay').classList.remove('d-none');
                    
                    // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                    setTimeout(() => {
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ/–≤–∫–ª–∞–¥–∫–µ
                        window.open(paymentUrl, '_blank');
                        document.querySelector('.qr-overlay').classList.add('d-none');
                    }, 1500);
                };
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
                document.getElementById('confirm-payment').onclick = function() {
                    completePayment(sessionId);
                };
                
                showLoading(false);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
                const paymentModal = new bootstrap.Modal(document.getElementById('paymentModal'));
                paymentModal.show();
            }, 500);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
        function completePayment(sessionId) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏
            showLoading();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏
            fetch('/api/payment-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    sessionId: sessionId,
                    status: 'completed'
                }),
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.success) {
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
                    const paymentModal = bootstrap.Modal.getInstance(document.getElementById('paymentModal'));
                    paymentModal.hide();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showNotification(`–ö–Ω–∏–≥–∞ —É—Å–ø–µ—à–Ω–æ –∫—É–ø–ª–µ–Ω–∞!`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥
                    fetchUserBooks(currentUserId);
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                    document.getElementById('success-close').onclick = function() {
                        successModal.hide();
                    };
                } else {
                    alert(data.message || '–¢”©–ª–µ–º–¥—ñ –∞—è“õ—Ç–∞—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã');
                }
            })
            .catch(error => {
                showLoading(false);
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã:', error);
                alert('–°–µ—Ä–≤–µ—Ä–≥–µ “õ–æ—Å—ã–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        function showLoading(show = true) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (show) {
                loadingOverlay.classList.add('show');
            } else {
                loadingOverlay.classList.remove('show');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'success', duration = 3000) {
            const toast = document.getElementById('notificationToast');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            if (type === 'error') {
                toast.style.backgroundColor = '#dc3545';
            } else if (type === 'warning') {
                toast.style.backgroundColor = '#ffc107';
                toast.style.color = '#333';
            } else {
                toast.style.backgroundColor = '#4bb71b';
            }
            
            toast.querySelector('.notification-content').textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–π –∂–∞–Ω—Ä–æ–≤–æ–π –∫–Ω–æ–ø–∫–∏
        function highlightActiveGenre(genreElement) {
            // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å active —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∂–∞–Ω—Ä–æ–≤
            document.querySelectorAll('.genres .genre-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å active –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
            genreElement.classList.add('active');
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º –∂–∞–Ω—Ä–æ–º
        function displayGenres() {
            const genres = [...new Set(books.map(book => book.genre))];
            const genresContainer = document.getElementById('genres');
            genresContainer.innerHTML = '';

            // –ö–Ω–æ–ø–∫–∞ "–ë–∞—Ä–ª—ã“õ –∫—ñ—Ç–∞–ø—Ç–∞—Ä" (–í—Å–µ –∫–Ω–∏–≥–∏)
            const allBooksButton = document.createElement('button');
            allBooksButton.textContent = "–ë–∞—Ä–ª—ã“õ –∫—ñ—Ç–∞–ø—Ç–∞—Ä";
            allBooksButton.classList.add('genre-button', 'active'); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–Ω–∞
            allBooksButton.onclick = function() {
                displayBooks(books);
                highlightActiveGenre(this);
            }
            genresContainer.appendChild(allBooksButton);

            // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∂–∞–Ω—Ä–æ–≤
            genres.forEach(genre => {
                const button = document.createElement('button');
                button.textContent = genre;
                button.classList.add('genre-button');
                button.onclick = function() {
                    filterByGenre(genre);
                    highlightActiveGenre(this);
                }
                genresContainer.appendChild(button);
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–∏–≥–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            displayBooks(books);
        }

        function showAllBooks() {
            displayBooks(books); // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏
            window.scrollTo({ top: document.getElementById('book-list').offsetTop, behavior: 'smooth' }); // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –∫–Ω–∏–≥–∞–º
        }

        function displayPopularBooks() {
            const popularBooksContainer = document.getElementById('popular-books-container');
            popularBooksContainer.innerHTML = '';

            popularBooks.forEach(book => {
                const bookItem = document.createElement('div');
                bookItem.classList.add('book-item'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∫–Ω–∏–≥–∏
                
                // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–π–¥–∂ –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫–Ω–∏–≥
                let paidBadge = '';
                if (book.isPaid) {
                    paidBadge = `<span class="paid-badge">${book.price} ‚Ç∏</span>`;
                }
                
                bookItem.innerHTML = `
                    ${paidBadge}
                    <img src="${book.image}" class="img-fluid" alt="${book.title}">
                    <h3>${book.title}</h3>
                    <p>${book.author}</p>
                    <button class="btn btn-secondary" onclick="showBookDetails('${book.title}')">–¢–æ–ª—ã“ì—ã—Ä–∞“õ</button>
                `;
                popularBooksContainer.appendChild(bookItem);
            });
        }
    </script>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
